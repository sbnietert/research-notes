\documentclass{article}

\usepackage[utf8]{inputenc}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{hyperref}
\usepackage{mathtools}

\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}

\newcommand{\dd}{\mathop{\mathrm{d}\!}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\E}{\mathbb{E}}
\newcommand{\Lip}{\mathrm{Lip}}
\newcommand{\N}{\mathcal{N}}
\renewcommand{\P}{\mathcal{P}}

\DeclareMathOperator{\supp}{supp}
\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\Var}{Var}
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\DeclarePairedDelimiter{\inner}{\langle}{\rangle}

\begin{document}

\section{Smoothed Barycenter Stuff}

Let $\lambda$ denote the Lebesgue measure on $\R^d$.

\begin{proposition}
    $W_p(\mu,\nu)^p$ is convex in $(\mu,\nu)$ for $p \in [1,\infty)$.
\end{proposition}
\begin{proof}
    Fix $\mu_1,\nu_1, \mu_2,\nu_2 \in \P_p(\R^d)$ and $t \in [0,1]$.
    Let $\pi_1 \in \Pi(\mu_1,\nu_1)$ be a transport plan achieving $W_p(\mu_1,\nu_1)$, and take $\pi_2 \in \Pi(\mu_2,\nu_2)$ to be a transport achieving $W_p(\mu_2,\nu_2)$. Next, define $\pi = t \pi_1 + (1 - t) \pi_2$. Checking marginals, we find $\pi \in \Pi(t \mu_1 + (1 - t)\mu_2, t \nu_1 + (1 - t)\nu_2)$, so
    \begin{align*}
        W_p(t \mu_1 &+ (1 - t)\mu_2,t \nu_1 + (1 - t)\nu_2)^p \leq \E_{X,Y \sim \pi}\norm{X - Y}^p \\
        &= t \E_{X,Y \sim \pi_1}\norm{X - Y}^p + (1 - t) \E_{X,Y \sim \pi_2}\norm{X - Y}^p \\
        &= t W_p(\mu_1,\nu_1)^p + (1 - t) W_p(\mu_2,\nu_2)^p.
    \end{align*}
\end{proof}

\begin{proposition}
    Let $\mu,\nu \in \P_2(\R^d)$ with $\mu \ll \lambda$, and let $X,Y$ be an optimal coupling of the pair w.r.t. $W_2$. Then, 
    \begin{enumerate}
        \item a regular conditional distribution of $Y$ given $X = x$ is supported on a single point, $\mu$-a.s.
        \item there exists a measurable mapping $T:D \subset \R^d \to \R^d$ with $\mu(D) = 1$ such that $Y = T(X)$ a.s.
        \item $T$ is the gradient of a convex function (implies next)
        \item $\inner{T(x) - T(x'), x - x'} \geq 0$ (can be strengthened to cyclically monotone);
        \item $W_2(\mu,\nu)^2 = \E[\norm{X - T(X)}^2]$.
    \end{enumerate}
\end{proposition}

TODO: Does 2 not imply 1? 2,5 hold for $p > 1$.

\begin{proposition}
    $W_p(\mu,\cdot)^p$ is strictly convex if $\mu \ll \lambda$ for $p \in (0,\infty)$.
\end{proposition}
\begin{proof}
    Fix $\mu,\nu_1,\nu_2 \in \P_p(\R^d)$ with $\mu \ll \lambda$ and let $t \in [0,1]$. Let $T_1, T_2$ denote the optimal transport maps from $\mu$ to $\nu_1$ and $\nu_2$ with respect to $W_p$ (existence guaranteed since $p > 1$ and $\mu \ll \lambda$). Let $\nu_t := t \nu_1 + (1-t) \nu_2$ and define on its support the random function
    \begin{equation*}
        T(x) = \begin{cases}
            T_1(x) & \text{with probability $t$}\\
            T_2(x) & \text{with probability $1-t$}.
        \end{cases}
    \end{equation*}
    If $X$ is distributed according to $\mu$, then
    \begin{align*}
        \Pr[T(X) \in A] &= t \cdot {T_1}_\#\mu(A) + (1 - t) \cdot {T_2}_\#\mu(A)\\
        &= t \nu_1(A) + (1-t) \nu_2(A) = \nu_t(A).
    \end{align*}
    Hence,
    \begin{align*}
        W_p(\mu,\nu_t)^p &\leq \E \norm{X - T(X)}^p\\
        &= t \E \norm{X - T_1(X)}^p + (1 - t) \E \norm{X - T_2(X)}^p\\
        &= t W_p(\nu_1)^p + (1-t) W_p(\nu_2)^p,
    \end{align*}
    with strict inequality unless $T$ is an optimal transport plan between $\mu$ and $\nu_t$. However, this would force $T$ to be deterministic (almost everywhere), requiring that $T_1 = T_2$ (almost everywhere). In this case, $\nu_1 = {T_1}_\# \mu = {T_2}_\# \mu = \nu_2$.
\end{proof}

\begin{corollary}
    $W_p^\sigma(\mu,\cdot)^p$ is strictly convex for $p \in (0,\infty)$.
\end{corollary}
\begin{proof}
    Convolution with $\N_\sigma$ is linear and non-singular. (Just requires noise model with non-vanishing characteristic function.)
\end{proof}

\begin{proposition}

\end{proposition}


\end{document}